<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AllBusiness - Advertising Platform</title>
    <style>
        /* (Keeping previous styles – only adding modal tweaks) */
        * { margin:0; padding:0; box-sizing:border-box; font-family:'Segoe UI', sans-serif; }
        body { background:#f0f4f8; color:#222; line-height:1.6; overflow-x:hidden; }
        :root {
            --primary: #4a90e2; --secondary: #50e3c2; --accent: #f5a623;
            --bg-gradient: linear-gradient(135deg, #f8fbff, #e0eaff);
            --glass: rgba(255,255,255,0.8); --shadow: 0 8px 32px rgba(31,38,135,0.15);
            --glow: 0 0 15px rgba(74,144,226,0.5);
        }
        header { position:fixed; top:0; left:0; right:0; z-index:1000; background:var(--glass); backdrop-filter:blur(12px); border-bottom:1px solid rgba(255,255,255,0.3); box-shadow:var(--shadow); }
        .navbar { max-width:1400px; margin:0 auto; padding:1rem 2rem; display:flex; align-items:center; justify-content:space-between; }
        .logo { font-size:1.8rem; font-weight:800; color:var(--primary); text-shadow:var(--glow); }
        .search-container { flex:1; max-width:500px; margin:0 2rem; position:relative; }
        .search-bar { display:flex; background:rgba(255,255,255,0.95); border-radius:50px; overflow:hidden; box-shadow:0 4px 15px rgba(0,0,0,0.08); border:1px solid rgba(74,144,226,0.2); }
        .search-bar input { flex:1; padding:1rem 1.8rem; border:none; font-size:1.05rem; background:transparent; outline:none; }
        .search-bar button { padding:1rem 1.8rem; background:var(--primary); color:white; border:none; cursor:pointer; transition:background 0.3s; }
        .search-bar button:hover { background:#357abd; }
        .autocomplete-dropdown { position:absolute; top:100%; left:0; right:0; background:white; border-radius:12px; margin-top:8px; box-shadow:0 10px 30px rgba(0,0,0,0.15); max-height:320px; overflow-y:auto; z-index:999; border:1px solid rgba(0,0,0,0.1); display:none; }
        .autocomplete-item { padding:0.9rem 1.6rem; cursor:pointer; transition:background 0.2s; }
        .autocomplete-item:hover, .autocomplete-item.highlight { background:#f0f7ff; color:var(--primary); }
        .nav-links { display:flex; align-items:center; gap:2.5rem; }
        .nav-links a { color:#333; text-decoration:none; font-weight:500; transition:color 0.3s; }
        .nav-links a:hover { color:var(--primary); }
        .auth-buttons button { padding:0.7rem 1.4rem; border-radius:50px; cursor:pointer; transition:all 0.3s; }
        #loginBtn { background:transparent; border:2px solid var(--primary); color:var(--primary); }
        #registerBtnHeader { background:var(--secondary); border:none; color:white; }
        .hamburger { display:none; font-size:1.8rem; cursor:pointer; color:var(--primary); }
        @media (max-width:992px) { .nav-links { position:absolute; top:100%; left:0; right:0; flex-direction:column; background:var(--glass); padding:2rem; transform:translateY(-100%); opacity:0; transition:all 0.4s; } .nav-links.active { transform:translateY(0); opacity:1; } .search-container { margin:1rem 0; max-width:none; } .hamburger { display:block; } }
        #hero { min-height:90vh; background:var(--bg-gradient); display:flex; flex-direction:column; justify-content:center; align-items:center; text-align:center; padding:8rem 2rem 4rem; }
        #hero h1 { font-size:4.2rem; color:var(--primary); text-shadow:var(--glow); }
        #hero p { font-size:1.6rem; max-width:700px; margin:1.5rem 0 3rem; }
        #searchResults { max-width:1200px; margin:0 auto 4rem; padding:0 2rem; display:grid; grid-template-columns:repeat(auto-fill, minmax(320px,1fr)); gap:2rem; }
        .business-card { background:white; border-radius:16px; padding:1.8rem; box-shadow:var(--shadow); transition:all 0.4s; }
        .business-card:hover { transform:translateY(-10px); box-shadow:var(--glow); }
        #loading, #noResults { text-align:center; margin:3rem; font-size:1.3rem; color:#555; }
        section { padding:6rem 2rem; }
        #about { background:white; text-align:center; }
        #pricing { background:var(--bg-gradient); text-align:center; }
        .pricing-tabs { display:flex; justify-content:center; gap:2.5rem; flex-wrap:wrap; }
        .pricing-card { background:white; border-radius:20px; padding:2.5rem; width:320px; box-shadow:var(--shadow); transition:all 0.4s; }
        .pricing-card:hover { transform:translateY(-12px); box-shadow:var(--glow); }
        footer { background:#2a2a2a; color:white; padding:4rem 2rem 2rem; text-align:center; }
        .footer-content { display:flex; justify-content:space-around; flex-wrap:wrap; max-width:1200px; margin:0 auto 3rem; }
        .modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.6); justify-content:center; align-items:center; z-index:2000; }
        .modal-content { background:white; padding:2.5rem; border-radius:20px; width:90%; max-width:460px; box-shadow:var(--shadow); }
        .close { float:right; font-size:2.2rem; cursor:pointer; color:#777; }
        .modal-content input { width:100%; padding:1rem; margin:0.8rem 0; border:1px solid #ddd; border-radius:10px; }
        .modal-content button { width:100%; padding:1.1rem; margin:0.6rem 0; border:none; border-radius:10px; cursor:pointer; font-size:1.05rem; }
        #googleBtn { background:#4285F4; color:white; display:flex; align-items:center; justify-content:center; gap:10px; }
        #googleBtn img { height:20px; }
        #emailSection { margin:1.5rem 0; text-align:center; color:#777; }
        #authMessage { margin-top:1rem; font-size:0.95rem; }
        .divider { display:flex; align-items:center; margin:1.5rem 0; color:#aaa; }
        .divider::before, .divider::after { content:''; flex:1; border-bottom:1px solid #ddd; }
        .divider span { padding:0 1rem; }
    </style>

    <!-- Firebase SDK (Auth + Realtime Database) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
        import { 
            getAuth, 
            createUserWithEmailAndPassword, 
            signInWithPopup, 
            GoogleAuthProvider 
        } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js";
        import { getDatabase, ref, set, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAojYRIH8FJL5B8yg1b3qxsc29vB3vLC-8",
            authDomain: "allbusiness-596cc.firebaseapp.com",
            databaseURL: "https://allbusiness-596cc-default-rtdb.firebaseio.com",
            projectId: "allbusiness-596cc",
            storageBucket: "allbusiness-596cc.firebasestorage.app",
            messagingSenderId: "665302840524",
            appId: "1:665302840524:web:e9c1078e14bc0de6a87e69",
            measurementId: "G-EMZFX7CE8V"
        };

        const app = initializeApp(firebaseConfig);
        window.auth = getAuth(app);
        window.db = getDatabase(app);
        window.ref = ref;
        window.set = set;
        window.serverTimestamp = serverTimestamp;
        window.GoogleAuthProvider = GoogleAuthProvider;
        window.signInWithPopup = signInWithPopup;
        window.createUserWithEmailAndPassword = createUserWithEmailAndPassword;
    </script>
</head>
<body>

    <!-- Header/Navbar (unchanged) -->
    <header>
        <nav class="navbar">
            <div class="logo">AllBusiness</div>
            <div class="search-container">
                <div class="search-bar">
                    <input type="text" id="searchInput" placeholder="Search business category (e.g. restaurant, gym...)">
                    <button onclick="searchBusinesses()">Search</button>
                </div>
                <div class="autocomplete-dropdown" id="suggestionsDropdown"></div>
            </div>
            <div class="nav-links" id="navLinks">
                <a href="#hero">Home</a>
                <a href="#about">About</a>
                <a href="#pricing">Pricing</a>
                <div class="auth-buttons">
                    <button id="loginBtn">Login</button>
                    <button id="registerBtnHeader">Sign Up</button>
                </div>
            </div>
            <div class="hamburger" id="hamburger">☰</div>
        </nav>
    </header>

    <!-- Hero / Search Results / About / Pricing / Footer (unchanged – omitted for brevity) -->

    <!-- Updated Modal with Google Sign-In -->
    <div id="registerModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">×</span>
            <h2>Sign Up or Log In</h2>

            <button id="googleBtn">
                <img src="https://www.google.com/favicon.ico" alt="Google"> 
                Continue with Google
            </button>

            <div class="divider"><span>or</span></div>

            <div id="emailSection">
                <input type="text" id="businessName" placeholder="Business Name *" required>
                <input type="email" id="email" placeholder="Email *" required>
                <input type="password" id="password" placeholder="Password *" required>
                <input type="text" id="category" placeholder="Category (e.g. restaurant, plumbing)" required>
                <button onclick="registerWithEmail()">Register with Email</button>
            </div>

            <p id="authMessage"></p>
        </div>
    </div>

    <script type="module">
        const { auth, db, ref, set, serverTimestamp, GoogleAuthProvider, signInWithPopup, createUserWithEmailAndPassword } = window;

        // Modal controls
        const modal = document.getElementById('registerModal');
        document.getElementById('registerBtnHeader').onclick = () => modal.style.display = 'flex';
        document.getElementById('loginBtn').onclick = () => {
            alert('Login form coming soon – for now use Sign Up with existing Google/email');
            modal.style.display = 'flex';
        };
        window.closeModal = () => modal.style.display = 'none';

        const messageEl = document.getElementById('authMessage');

        // ────────────────────────────────────────────────
        // GOOGLE SIGN-IN
        // ────────────────────────────────────────────────
        document.getElementById('googleBtn').onclick = async () => {
            messageEl.textContent = 'Connecting to Google...';
            messageEl.style.color = '#555';

            const provider = new GoogleAuthProvider();
            // Optional: force account selection (useful if multiple Google accounts)
            // provider.setCustomParameters({ prompt: 'select_account' });

            try {
                const result = await signInWithPopup(auth, provider);
                const user = result.user;

                // Check if new user (first sign-in)
                const isNewUser = result._tokenResponse?.isNewUser || false;

                if (isNewUser) {
                    // New user → ask for business details or auto-create minimal profile
                    // For simplicity: create business entry with defaults (user can edit later)
                    const businessRef = ref(db, 'businesses/' + user.uid);
                    await set(businessRef, {
                        name: user.displayName || "New Business",
                        category: "general",
                        email: user.email,
                        uid: user.uid,
                        createdAt: serverTimestamp(),
                        photoURL: user.photoURL || null
                    });

                    messageEl.style.color = 'green';
                    messageEl.textContent = 'Welcome! Your business profile has been created.';
                } else {
                    messageEl.style.color = 'green';
                    messageEl.textContent = `Welcome back, ${user.displayName || 'User'}!`;
                }

                setTimeout(closeModal, 2200);
            } catch (error) {
                let msg = 'An error occurred.';
                if (error.code === 'auth/popup-blocked') {
                    msg = 'Popup was blocked. Please allow popups for this site.';
                } else if (error.code === 'auth/popup-closed-by-user') {
                    msg = 'Sign-in cancelled.';
                } else if (error.code === 'auth/account-exists-with-different-credential') {
                    msg = 'Account exists with different sign-in method. Try email/password.';
                }
                messageEl.style.color = '#e74c3c';
                messageEl.textContent = msg;
                console.error(error);
            }
        };

        // ────────────────────────────────────────────────
        // EMAIL/PASSWORD REGISTER (unchanged logic)
        // ────────────────────────────────────────────────
        window.registerWithEmail = async () => {
            const name = document.getElementById('businessName').value.trim();
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value;
            let category = document.getElementById('category').value.trim().toLowerCase();

            if (!name || !email || !password || !category) {
                messageEl.textContent = 'Please fill in all fields.';
                messageEl.style.color = '#e74c3c';
                return;
            }

            messageEl.textContent = 'Creating account...';
            messageEl.style.color = '#555';

            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;

                const businessRef = ref(db, 'businesses/' + user.uid);
                await set(businessRef, {
                    name,
                    category,
                    email,
                    uid: user.uid,
                    createdAt: serverTimestamp()
                });

                messageEl.style.color = 'green';
                messageEl.textContent = 'Success! Your business is registered.';
                setTimeout(closeModal, 2200);
            } catch (error) {
                messageEl.style.color = '#e74c3c';
                messageEl.textContent = error.message;
            }
        };

        // (Your previous search/autocomplete code goes here – unchanged)
        // ...

        // Mobile menu toggle (unchanged)
        document.getElementById('hamburger').onclick = () => {
            document.getElementById('navLinks').classList.toggle('active');
        };
    </script>
</body>
</html>
