<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Lumina • Real-Time Teacher Portal</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

  <style>
    :root {
      --bg: #0f172a; --surface: #1e293b; --surface-elev: #334155;
      --text: #f8fafc; --text-muted: #94a3b8; --border: rgba(255, 255, 255, 0.1);
      --primary: #8b5cf6; --danger: #ef4444; --warning: #f59e0b; --success: #10b981;
      --radius: 24px;
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); transition: all 0.3s ease; }
    .container { max-width: 1300px; margin: 0 auto; padding: 2rem; }
    .card { background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius); padding: 1.5rem; margin-bottom: 1.5rem; box-shadow: 0 10px 25px rgba(0,0,0,0.2); }
    .hidden { display: none !important; }
    .brand-main { font-size: 3rem; font-weight: 800; background: linear-gradient(to right, #a78bfa, #6366f1); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-align: center; }
    .brand-sub { text-align: center; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 4px; color: var(--text-muted); margin-bottom: 2rem; }
    .dashboard-grid { display: grid; grid-template-columns: 320px 1fr 320px; gap: 20px; }
    .btn-modern { background: linear-gradient(135deg, var(--primary), #6366f1); color: white; width: 100%; padding: 0.9rem; border: none; border-radius: 50px; font-weight: 700; cursor: pointer; transition: 0.3s; }
    .btn-modern:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(139, 92, 246, 0.4); }
    input, textarea, select { width: 100%; padding: 0.8rem; background: rgba(15, 23, 42, 0.6); border: 1px solid var(--border); color: white; border-radius: 12px; margin-bottom: 10px; }
    .learner-row { display: flex; align-items: center; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid var(--border); }
    .btn-delete { background: none; border: 1px solid var(--danger); color: var(--danger); padding: 4px 8px; border-radius: 6px; cursor: pointer; font-size: 0.7rem; }
    .btn-delete:hover { background: var(--danger); color: white; }
    .chat-box { height: 350px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; padding-right: 5px; }
    .msg { padding: 10px; border-radius: 15px; background: var(--surface-elev); max-width: 85%; font-size: 0.9rem; border: 1px solid var(--border); }
    .msg.me { align-self: flex-end; background: var(--primary); border: none; }
  </style>
</head>
<body>

<div class="container">
  <div id="authSection" style="max-width: 400px; margin: 10vh auto;">
    <h1 class="brand-main">Lumina</h1>
    <p class="brand-sub">Real-Time Teacher Portal</p>
    
    <div id="loginForm" class="card">
      <input type="text" id="siUser" placeholder="Username">
      <input type="password" id="siPass" placeholder="Password">
      <button class="btn-modern" onclick="handleLogin()">Sign In</button>
      <p style="text-align:center; margin-top:15px; font-size:0.8rem; cursor:pointer; color:var(--primary);" onclick="toggleAuth()">New Teacher? Create Account</p>
    </div>

    <div id="regForm" class="card hidden">
      <input type="text" id="suUser" placeholder="Full Name">
      <input type="password" id="suPass" placeholder="Password">
      <textarea id="suSubjects" placeholder="Subjects (e.g. Math, Science)"></textarea>
      <textarea id="suClasses" placeholder="Grades (e.g. Grade 10, 11)"></textarea>
      <button class="btn-modern" onclick="handleRegister()">Register</button>
      <p style="text-align:center; margin-top:15px; font-size:0.8rem; cursor:pointer; color:var(--primary);" onclick="toggleAuth()">Back to Login</p>
    </div>
  </div>

  <div id="dashboard" class="hidden">
    <header style="display:flex; justify-content:space-between; align-items:center; margin-bottom:2rem;">
      <div>
        <h1 style="font-size: 1.8rem; color: var(--primary);">Lumina <span style="font-size: 0.7rem; color: var(--success); vertical-align: middle;">● LIVE</span></h1>
        <p id="teacherWelcome" style="font-size:0.8rem; color:var(--text-muted);"></p>
      </div>
      <button onclick="location.reload()" class="btn-modern" style="width:auto; padding:8px 20px;">Sign Out</button>
    </header>

    <div class="dashboard-grid">
      <aside>
        <div class="card">
          <h3>Add Learner</h3>
          <input type="email" id="lEmail" placeholder="Email">
          <input type="text" id="lName" placeholder="Name">
          <button class="btn-modern" onclick="addLearner()">Enroll</button>
        </div>
        <div class="card">
          <h3>Class Directory</h3>
          <div id="learnerDir"></div>
        </div>
      </aside>

      <main>
        <div class="card">
          <h3>New Assignment</h3>
          <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
            <select id="tSubj"></select>
            <select id="tClass"></select>
          </div>
          <input type="text" id="tTitle" placeholder="Title">
          <textarea id="tDesc" placeholder="Instructions..."></textarea>
          <button class="btn-modern" onclick="addTask()">Post Live</button>
        </div>
        <div id="taskFeed"></div>
      </main>

      <section>
        <div class="card">
          <h3>Announcements</h3>
          <div id="chatBox" class="chat-box" style="margin: 15px 0;"></div>
          <div style="display:flex; gap:5px;">
            <input type="text" id="chatMsg" placeholder="Message..." style="margin:0;">
            <button class="btn-modern" style="width:auto; padding:0 15px;" onclick="sendChat()">Send</button>
          </div>
        </div>
      </section>
    </div>
  </div>
</div>

<script>
  // --- PASTE YOUR FIREBASE CONFIG HERE ---
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT.firebaseapp.com",
    databaseURL: "https://YOUR_PROJECT.firebaseio.com",
    projectId: "YOUR_PROJECT",
    storageBucket: "YOUR_PROJECT.appspot.com",
    messagingSenderId: "YOUR_ID",
    appId: "YOUR_APP_ID"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  let currentUser = null;

  function toggleAuth() {
    document.getElementById('loginForm').classList.toggle('hidden');
    document.getElementById('regForm').classList.toggle('hidden');
  }

  function handleRegister() {
    const name = document.getElementById('suUser').value.trim();
    const pass = document.getElementById('suPass').value;
    if(!name || !pass) return alert("Fill all fields");

    db.ref('teachers/' + name).set({
      name, pass,
      subjects: document.getElementById('suSubjects').value.split(',').map(s => s.trim()),
      classes: document.getElementById('suClasses').value.split(',').map(c => c.trim())
    }).then(() => {
      alert("Teacher account created!");
      toggleAuth();
    });
  }

  function handleLogin() {
    const name = document.getElementById('siUser').value.trim();
    const pass = document.getElementById('siPass').value;

    db.ref('teachers/' + name).once('value', (snap) => {
      const user = snap.val();
      if(user && user.pass === pass) {
        currentUser = user;
        launchDashboard();
      } else {
        alert("Invalid credentials");
      }
    });
  }

  function launchDashboard() {
    document.getElementById('authSection').classList.add('hidden');
    document.getElementById('dashboard').classList.remove('hidden');
    document.getElementById('teacherWelcome').textContent = `Logged in as ${currentUser.name}`;

    // Fill selects
    document.getElementById('tSubj').innerHTML = currentUser.subjects.map(s => `<option>${s}</option>`).join('');
    document.getElementById('tClass').innerHTML = currentUser.classes.map(c => `<option>${c}</option>`).join('');

    // --- REAL-TIME LISTENERS ---

    // 1. Listen for Learners
    db.ref('learners/' + currentUser.name).on('value', (snap) => {
      const dir = document.getElementById('learnerDir');
      dir.innerHTML = '';
      if(!snap.exists()) dir.innerHTML = '<p style="opacity:0.5; font-size:0.8rem;">No students yet.</p>';
      snap.forEach((child) => {
        const l = child.val();
        dir.innerHTML += `
          <div class="learner-row">
            <div><strong>${l.name}</strong><br><small style="color:var(--text-muted)">${l.email}</small></div>
            <button class="btn-delete" onclick="removeLearner('${child.key}')">×</button>
          </div>`;
      });
    });

    // 2. Listen for Tasks
    db.ref('tasks').on('value', (snap) => {
      const feed = document.getElementById('taskFeed');
      feed.innerHTML = '';
      let hasTasks = false;
      snap.forEach((child) => {
        const t = child.val();
        if(t.teacher === currentUser.name) {
          hasTasks = true;
          feed.innerHTML += `
            <div class="card" style="border-left: 4px solid var(--primary);">
              <small style="color:var(--primary); font-weight:bold;">${t.subj} • ${t.class}</small>
              <h3>${t.title}</h3>
              <p style="font-size:0.9rem; margin-top:5px; opacity:0.8;">${t.desc}</p>
            </div>`;
        }
      });
      if(!hasTasks) feed.innerHTML = '<p style="text-align:center; opacity:0.5;">No active tasks.</p>';
    });

    // 3. Listen for Chat
    db.ref('announcements').limitToLast(20).on('value', (snap) => {
      const box = document.getElementById('chatBox');
      box.innerHTML = '';
      snap.forEach((child) => {
        const m = child.val();
        const isMe = m.user === currentUser.name;
        box.innerHTML += `<div class="msg ${isMe ? 'me' : ''}">
          <small style="display:block; font-weight:bold; font-size:0.7rem; margin-bottom:2px;">${m.user}</small>
          ${m.text}
        </div>`;
      });
      box.scrollTop = box.scrollHeight;
    });
  }

  function addLearner() {
    const name = document.getElementById('lName').value;
    const email = document.getElementById('lEmail').value;
    if(!name || !email) return;
    db.ref('learners/' + currentUser.name).push({ name, email });
    document.getElementById('lName').value = '';
    document.getElementById('lEmail').value = '';
  }

  function removeLearner(key) {
    if(confirm("Remove student?")) {
      db.ref('learners/' + currentUser.name + '/' + key).remove();
    }
  }

  function addTask() {
    const title = document.getElementById('tTitle').value;
    if(!title) return;
    db.ref('tasks').push({
      teacher: currentUser.name,
      title: title,
      subj: document.getElementById('tSubj').value,
      class: document.getElementById('tClass').value,
      desc: document.getElementById('tDesc').value,
      timestamp: Date.now()
    });
    document.getElementById('tTitle').value = '';
    document.getElementById('tDesc').value = '';
  }

  function sendChat() {
    const text = document.getElementById('chatMsg').value;
    if(!text) return;
    db.ref('announcements').push({
      user: currentUser.name,
      text: text,
      timestamp: Date.now()
    });
    document.getElementById('chatMsg').value = '';
  }
</script>
</body>
</html>
