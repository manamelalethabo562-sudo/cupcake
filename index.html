<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AllBusiness - Advertising Platform</title>
  <style>
    /* ────────────────────────────────────────────────
       Previous styles (kept compact – add your full CSS here)
    ──────────────────────────────────────────────── */
    * { margin:0; padding:0; box-sizing:border-box; font-family:'Segoe UI', sans-serif; }
    body { background:#f0f4f8; color:#222; line-height:1.6; }
    :root {
      --primary:#4a90e2; --secondary:#50e3c2; --accent:#f5a623;
      --glow:0 0 15px rgba(74,144,226,0.5);
      --shadow:0 8px 32px rgba(31,38,135,0.15);
    }
    header { position:fixed; top:0; left:0; right:0; background:rgba(255,255,255,0.85); backdrop-filter:blur(12px); box-shadow:var(--shadow); z-index:1000; }
    .navbar { max-width:1400px; margin:0 auto; padding:1rem 2rem; display:flex; align-items:center; justify-content:space-between; }
    .logo { font-size:1.9rem; font-weight:800; color:var(--primary); text-shadow:var(--glow); }
    .search-container { flex:1; max-width:520px; margin:0 1.5rem; position:relative; }
    .search-bar { display:flex; background:white; border-radius:999px; overflow:hidden; border:1px solid #ddd; box-shadow:0 2px 12px rgba(0,0,0,0.08); }
    .search-bar input { flex:1; padding:0.95rem 1.6rem; border:none; font-size:1.05rem; outline:none; }
    .search-bar button { padding:0 1.8rem; background:var(--primary); color:white; border:none; cursor:pointer; }
    .autocomplete-dropdown {
      position:absolute; top:100%; left:0; right:0;
      background:white; border-radius:12px; margin-top:6px;
      box-shadow:0 12px 32px rgba(0,0,0,0.18);
      max-height:340px; overflow-y:auto; z-index:9999;
      border:1px solid #e0e0e0; display:none;
    }
    .autocomplete-item {
      padding:0.85rem 1.5rem; cursor:pointer; transition:0.15s;
    }
    .autocomplete-item:hover, .autocomplete-item.highlight {
      background:#eef7ff; color:var(--primary);
    }
    .autocomplete-item em { font-style:normal; color:var(--primary); font-weight:600; }

    /* ... rest of your styles (hero, modal, pricing, etc.) ... */
    .modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.6); justify-content:center; align-items:center; z-index:2000; }
    .modal-content { background:white; padding:2.4rem; border-radius:16px; width:90%; max-width:440px; box-shadow:var(--shadow); }
    #googleBtn { background:#4285F4; color:white; display:flex; align-items:center; justify-content:center; gap:12px; }
    #googleBtn img { height:22px; }
    .divider { display:flex; align-items:center; margin:1.4rem 0; color:#aaa; }
    .divider::before, .divider::after { content:''; flex:1; border-bottom:1px solid #ddd; }
    .divider span { padding:0 1.2rem; }
  </style>
</head>
<body>

  <!-- Header -->
  <header>
    <nav class="navbar">
      <div class="logo">AllBusiness</div>
      <div class="search-container">
        <div class="search-bar">
          <input type="text" id="searchInput" placeholder="Search categories (restaurant, gym, plumber...)">
          <button>Search</button>
        </div>
        <div class="autocomplete-dropdown" id="suggestions"></div>
      </div>
      <div>
        <button id="registerBtnHeader">Sign Up</button>
      </div>
    </nav>
  </header>

  <!-- Auth Modal (simplified for focus) -->
  <div id="registerModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="document.getElementById('registerModal').style.display='none'">×</span>
      <h2>Join AllBusiness</h2>
      <button id="googleBtn"><img src="https://www.google.com/favicon.ico" alt="G"> Continue with Google</button>
      <div class="divider"><span>or</span></div>
      <!-- Your email fields here -->
      <p id="authMessage"></p>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
    import { getDatabase, ref, query, orderByChild, startAt, endAt, limitToFirst, get } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAojYRIH8FJL5B8yg1b3qxsc29vB3vLC-8",
      authDomain: "allbusiness-596cc.firebaseapp.com",
      databaseURL: "https://allbusiness-596cc-default-rtdb.firebaseio.com",
      projectId: "allbusiness-596cc",
      storageBucket: "allbusiness-596cc.firebasestorage.app",
      messagingSenderId: "665302840524",
      appId: "1:665302840524:web:e9c1078e14bc0de6a87e69",
      measurementId: "G-EMZFX7CE8V"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const input = document.getElementById('searchInput');
    const dropdown = document.getElementById('suggestions');
    let currentFocus = -1;

    // ────────────────────────────────────────────────
    // CATEGORY AUTOCOMPLETE (Realtime Database – prefix match)
    // ────────────────────────────────────────────────
    async function showSuggestions() {
      const val = input.value.trim().toLowerCase();
      dropdown.innerHTML = '';
      currentFocus = -1;

      if (val.length < 2) {
        dropdown.style.display = 'none';
        return;
      }

      try {
        const q = query(
          ref(db, 'businesses'),
          orderByChild('category'),
          startAt(val),
          endAt(val + '\uf8ff'),
          limitToFirst(12)
        );

        const snapshot = await get(q);

        if (!snapshot.exists()) {
          dropdown.style.display = 'none';
          return;
        }

        const unique = new Set();
        snapshot.forEach(child => {
          const cat = child.val().category;
          if (cat && cat.startsWith(val)) unique.add(cat);
        });

        if (unique.size === 0) {
          dropdown.style.display = 'none';
          return;
        }

        unique.forEach(cat => {
          const item = document.createElement('div');
          item.className = 'autocomplete-item';
          const highlighted = cat.replace(new RegExp(val, 'gi'), m => `<em>${m}</em>`);
          item.innerHTML = highlighted;
          item.onclick = () => {
            input.value = cat;
            dropdown.style.display = 'none';
            // Optional: auto-trigger full search
            // searchBusinesses(cat);
          };
          dropdown.appendChild(item);
        });

        dropdown.style.display = 'block';
      } catch (err) {
        console.error(err);
        dropdown.style.display = 'none';
      }
    }

    // Keyboard support
    function handleKey(e) {
      const items = dropdown.querySelectorAll('.autocomplete-item');
      if (!items.length) return;

      if (e.key === 'ArrowDown') {
        currentFocus = (currentFocus + 1) % items.length;
        highlight(items);
      } else if (e.key === 'ArrowUp') {
        currentFocus = (currentFocus - 1 + items.length) % items.length;
        highlight(items);
      } else if (e.key === 'Enter' && currentFocus > -1) {
        e.preventDefault();
        items[currentFocus].click();
      } else if (e.key === 'Escape') {
        dropdown.style.display = 'none';
      }
    }

    function highlight(items) {
      items.forEach((el, i) => el.classList.toggle('highlight', i === currentFocus));
      if (currentFocus >= 0) items[currentFocus].scrollIntoView({ block: 'nearest' });
    }

    // Events
    input.addEventListener('input', showSuggestions);
    input.addEventListener('keydown', handleKey);

    document.addEventListener('click', e => {
      if (!input.contains(e.target) && !dropdown.contains(e.target)) {
        dropdown.style.display = 'none';
      }
    });

    // Optional: full search when pressing the button
    window.searchBusinesses = () => {
      const term = input.value.trim().toLowerCase();
      if (!term) return;
      alert(`Searching businesses in category: ${term}\n(Implement full list fetch here)`);
      dropdown.style.display = 'none';
    };

    // Your Google / Email auth logic here (from previous messages) ...
  </script>
</body>
</html>
