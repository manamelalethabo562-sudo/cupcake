<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Lumina â€¢ Education Portal</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0a0e1a; --surface: #1a1f2e; --surface-elev: #232d50;
      --text: #f8fafc; --text-muted: #cbd5e1; --border: rgba(203, 213, 225, 0.2);
      --primary: #8b5cf6; --success: #34d399; --danger: #f87171;
      --radius: 12px;
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); line-height: 1.6; }
    
    /* Layout */
    .container { max-width: 1000px; margin: 2rem auto; padding: 0 1rem; }
    .card { background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius); padding: 2rem; margin-bottom: 1.5rem; }
    .hidden { display: none !important; }
    
    /* Forms & UI */
    input, textarea, select { 
      width: 100%; padding: 0.8rem; background: rgba(0,0,0,0.2); 
      border: 1px solid var(--border); color: white; border-radius: 8px; margin-bottom: 1rem;
    }
    button { 
      padding: 0.8rem 1.5rem; border: none; border-radius: 8px; cursor: pointer; 
      font-weight: 600; transition: 0.2s;
    }
    .btn-primary { background: var(--primary); color: white; }
    .btn-outline { background: transparent; border: 1px solid var(--border); color: white; }
    
    /* Task & Chat Styles */
    .task-item { background: var(--surface-elev); padding: 1rem; border-radius: 8px; margin-bottom: 1rem; border-left: 4px solid var(--primary); }
    .chat-box { height: 300px; overflow-y: auto; background: #000; padding: 1rem; border-radius: 8px; margin-bottom: 1rem; display: flex; flex-direction: column; }
    .msg { margin-bottom: 0.8rem; padding: 0.5rem 1rem; border-radius: 15px; max-width: 80%; }
    .msg.teacher { background: var(--primary); align-self: flex-start; }
    .msg.learner { background: #444; align-self: flex-end; }
    .role-badge { font-size: 0.7rem; background: var(--primary); padding: 2px 6px; border-radius: 4px; margin-right: 5px; }

    header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; }
  </style>
</head>
<body>

<div class="container">
  <div id="authSection" class="card" style="max-width: 400px; margin: 10vh auto;">
    <h2 id="authTitle">Teacher/Learner Login</h2>
    <div style="display: flex; gap: 10px; margin: 1rem 0;">
      <button class="btn-outline" onclick="setRole('teacher')" id="roleT">I am a Teacher</button>
      <button class="btn-outline" onclick="setRole('learner')" id="roleL">I am a Learner</button>
    </div>
    <input type="text" id="username" placeholder="Enter Name">
    <input type="password" id="password" placeholder="Password">
    <button class="btn-primary" style="width: 100%;" onclick="handleAuth()">Login / Sign Up</button>
  </div>

  <div id="dashboard" class="hidden">
    <header>
      <h1>Lumina <span id="viewLabel" style="font-size: 1rem; opacity: 0.6;"></span></h1>
      <button class="btn-outline" onclick="logout()">Logout</button>
    </header>

    <div style="display: grid; grid-template-columns: 1.5fr 1fr; gap: 20px;">
      
      <div>
        <div id="teacherOnly" class="card hidden">
          <h3>Create New Task</h3>
          <input type="text" id="taskTitle" placeholder="Task Title">
          <textarea id="taskDesc" placeholder="Instructions for learners..."></textarea>
          <button class="btn-primary" onclick="addTask()">Post Task</button>
        </div>

        <div class="card">
          <h3>Current Tasks</h3>
          <div id="taskList"></div>
        </div>
      </div>

      <div>
        <div class="card">
          <h3>Class Chat</h3>
          <div id="chatBox" class="chat-box"></div>
          <div style="display: flex; gap: 5px;">
            <input type="text" id="chatInput" placeholder="Type message..." style="margin-bottom:0;">
            <button class="btn-primary" onclick="sendMessage()">Send</button>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<script>
  let currentUser = null;
  let selectedRole = 'teacher';

  // --- Core Data Controllers ---
  const db = {
    get: (key) => JSON.parse(localStorage.getItem('lumina_' + key) || '[]'),
    save: (key, data) => localStorage.setItem('lumina_' + key, JSON.stringify(data))
  };

  // --- Auth Logic ---
  function setRole(role) {
    selectedRole = role;
    document.getElementById('roleT').style.borderColor = role === 'teacher' ? 'var(--primary)' : 'var(--border)';
    document.getElementById('roleL').style.borderColor = role === 'learner' ? 'var(--primary)' : 'var(--border)';
  }

  function handleAuth() {
    const user = document.getElementById('username').value.trim();
    const pass = document.getElementById('password').value;
    if (!user || !pass) return alert("Fill all fields");

    let users = db.get('users');
    let existing = users.find(u => u.name === user);

    if (existing) {
      if (existing.pass !== pass) return alert("Wrong password");
      currentUser = existing;
    } else {
      currentUser = { name: user, pass: pass, role: selectedRole };
      users.push(currentUser);
      db.save('users', users);
    }

    showDashboard();
  }

  function showDashboard() {
    document.getElementById('authSection').classList.add('hidden');
    document.getElementById('dashboard').classList.remove('hidden');
    document.getElementById('viewLabel').textContent = `(${currentUser.role}: ${currentUser.name})`;
    
    if (currentUser.role === 'teacher') {
      document.getElementById('teacherOnly').classList.remove('hidden');
    }
    renderTasks();
    renderChat();
    setInterval(renderChat, 3000); // Simple auto-refresh for chat
  }

  // --- Task Management ---
  function addTask() {
    const title = document.getElementById('taskTitle').value;
    const desc = document.getElementById('taskDesc').value;
    if (!title) return;

    let tasks = db.get('tasks');
    tasks.push({ id: Date.now(), title, desc, teacher: currentUser.name, answers: [] });
    db.save('tasks', tasks);
    
    document.getElementById('taskTitle').value = '';
    document.getElementById('taskDesc').value = '';
    renderTasks();
  }

  function renderTasks() {
    const tasks = db.get('tasks');
    const container = document.getElementById('taskList');
    container.innerHTML = tasks.length ? '' : '<p>No tasks assigned yet.</p>';

    tasks.forEach(task => {
      let html = `
        <div class="task-item">
          <strong>${task.title}</strong>
          <p style="font-size: 0.9rem; color: var(--text-muted);">${task.desc}</p>
          <hr style="margin: 10px 0; opacity: 0.1;">
      `;

      if (currentUser.role === 'learner') {
        html += `
          <input type="text" id="ans-${task.id}" placeholder="Type your answer...">
          <button class="btn-primary" style="padding: 0.4rem 1rem; font-size: 0.8rem;" onclick="submitAnswer(${task.id})">Submit Answer</button>
        `;
      } else {
        html += `<h4>Submissions:</h4>`;
        task.answers.forEach(a => {
          html += `<div style="font-size:0.8rem; margin-top:5px;"><b>${a.user}:</b> ${a.text}</div>`;
        });
      }
      html += `</div>`;
      container.innerHTML += html;
    });
  }

  function submitAnswer(taskId) {
    const text = document.getElementById(`ans-${taskId}`).value;
    if (!text) return;

    let tasks = db.get('tasks');
    const taskIdx = tasks.findIndex(t => t.id === taskId);
    tasks[taskIdx].answers.push({ user: currentUser.name, text: text });
    db.save('tasks', tasks);
    alert("Answer sent to teacher!");
    renderTasks();
  }

  // --- Chat Management ---
  function sendMessage() {
    const text = document.getElementById('chatInput').value;
    if (!text) return;

    let messages = db.get('messages');
    messages.push({ user: currentUser.name, role: currentUser.role, text: text, time: new Date().toLocaleTimeString() });
    db.save('messages', messages);
    document.getElementById('chatInput').value = '';
    renderChat();
  }

  function renderChat() {
    const messages = db.get('messages');
    const box = document.getElementById('chatBox');
    box.innerHTML = '';
    messages.forEach(m => {
      const isMe = m.user === currentUser.name;
      box.innerHTML += `
        <div class="msg ${m.role}">
          <span class="role-badge">${m.role}</span>
          <small>${m.user}</small><br>${m.text}
        </div>`;
    });
    box.scrollTop = box.scrollHeight;
  }

  function logout() { location.reload(); }
  
  // Initialize role
  setRole('teacher');
</script>

</body>
</html>
