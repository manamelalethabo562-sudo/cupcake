<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Lumina • Real-Time Teacher Portal</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

  <style>
    :root {
      --bg: #0f172a; --surface: #1e293b; --surface-elev: #334155;
      --text: #f8fafc; --text-muted: #94a3b8; --border: rgba(255, 255, 255, 0.1);
      --primary: #8b5cf6; --danger: #ef4444; --warning: #f59e0b; --success: #10b981;
      --radius: 24px;
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); }
    .container { max-width: 1300px; margin: 0 auto; padding: 2rem; }
    .card { background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius); padding: 1.5rem; margin-bottom: 1.5rem; }
    .hidden { display: none !important; }
    .brand-main { font-size: 3rem; font-weight: 800; background: linear-gradient(to right, #a78bfa, #6366f1); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-align: center; }
    .brand-sub { text-align: center; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 4px; color: var(--text-muted); margin-bottom: 2rem; }
    .dashboard-grid { display: grid; grid-template-columns: 320px 1fr 320px; gap: 20px; }
    .btn-modern { background: linear-gradient(135deg, var(--primary), #6366f1); color: white; width: 100%; padding: 0.9rem; border: none; border-radius: 50px; font-weight: 700; cursor: pointer; transition: 0.3s; }
    input, textarea, select { width: 100%; padding: 0.8rem; background: rgba(15, 23, 42, 0.6); border: 1px solid var(--border); color: white; border-radius: 12px; margin-bottom: 10px; }
    .learner-row { display: flex; align-items: center; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid var(--border); }
    .btn-delete { background: none; border: 1px solid var(--danger); color: var(--danger); padding: 4px 8px; border-radius: 6px; cursor: pointer; font-size: 0.7rem; }
  </style>
</head>
<body>

<div class="container">
  <div id="authSection" style="max-width: 400px; margin: 10vh auto;">
    <h1 class="brand-main">Lumina</h1>
    <p class="brand-sub">Real-Time Portal</p>
    
    <div id="loginForm" class="card">
      <input type="text" id="siUser" placeholder="Username">
      <input type="password" id="siPass" placeholder="Password">
      <button class="btn-modern" onclick="handleLogin()">Sign In</button>
      <p style="text-align:center; margin-top:15px; font-size:0.8rem; cursor:pointer; color:var(--primary);" onclick="toggleAuth()">Create Teacher Account</p>
    </div>

    <div id="regForm" class="card hidden">
      <input type="text" id="suUser" placeholder="Full Name">
      <input type="password" id="suPass" placeholder="Password">
      <textarea id="suSubjects" placeholder="Subjects (e.g. Math, IT)"></textarea>
      <textarea id="suClasses" placeholder="Grades (e.g. Grade 10, 11)"></textarea>
      <button class="btn-modern" onclick="handleRegister()">Register</button>
    </div>
  </div>

  <div id="dashboard" class="hidden">
    <header style="display:flex; justify-content:space-between; align-items:center; margin-bottom:2rem;">
      <h1>Lumina <span style="font-size:0.8rem; color:var(--success);">● LIVE</span></h1>
      <button onclick="location.reload()" class="btn-modern" style="width:auto; padding:8px 20px;">Sign Out</button>
    </header>

    <div class="dashboard-grid">
      <aside>
        <div class="card">
          <h3>Add Learner</h3>
          <input type="email" id="lEmail" placeholder="Email">
          <input type="text" id="lName" placeholder="Name">
          <button class="btn-modern" onclick="addLearner()">Enroll</button>
        </div>
        <div class="card">
          <h3>Class Directory</h3>
          <div id="learnerDir"></div>
        </div>
      </aside>

      <main>
        <div class="card">
          <h3>New Assignment</h3>
          <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
            <select id="tSubj"></select>
            <select id="tClass"></select>
          </div>
          <input type="text" id="tTitle" placeholder="Title">
          <textarea id="tDesc" placeholder="Description"></textarea>
          <button class="btn-modern" onclick="addTask()">Post Live</button>
        </div>
        <div id="taskFeed"></div>
      </main>

      <section>
        <div class="card">
          <h3>Live Chat</h3>
          <div id="chatBox" style="height:300px; overflow-y:auto; margin-bottom:10px;"></div>
          <input type="text" id="chatMsg" placeholder="Message..." style="margin:0;">
          <button class="btn-modern" style="margin-top:5px;" onclick="sendChat()">Send</button>
        </div>
      </section>
    </div>
  </div>
</div>

<script>
  // 1. YOUR FIREBASE CONFIG
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT.firebaseapp.com",
    databaseURL: "https://YOUR_PROJECT.firebaseio.com",
    projectId: "YOUR_PROJECT",
    storageBucket: "YOUR_PROJECT.appspot.com",
    messagingSenderId: "YOUR_ID",
    appId: "YOUR_APP_ID"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const rdb = firebase.database();

  let currentUser = null;

  function toggleAuth() {
    document.getElementById('loginForm').classList.toggle('hidden');
    document.getElementById('regForm').classList.toggle('hidden');
  }

  // 2. REAL-TIME REGISTRATION
  function handleRegister() {
    const name = document.getElementById('suUser').value;
    const pass = document.getElementById('suPass').value;
    if(!name || !pass) return;

    rdb.ref('users/' + name).set({
      name, pass,
      subjects: document.getElementById('suSubjects').value.split(','),
      classes: document.getElementById('suClasses').value.split(',')
    }).then(() => { alert("Account Ready!"); toggleAuth(); });
  }

  // 3. LOGIN & REAL-TIME LISTENERS
  function handleLogin() {
    const name = document.getElementById('siUser').value;
    const pass = document.getElementById('siPass').value;

    rdb.ref('users/' + name).once('value', (snap) => {
      const user = snap.val();
      if(user && user.pass === pass) {
        currentUser = user;
        startRealtimeApp();
      } else { alert("Error"); }
    });
  }

  function startRealtimeApp() {
    document.getElementById('authSection').classList.add('hidden');
    document.getElementById('dashboard').classList.remove('hidden');

    // Fill selects
    document.getElementById('tSubj').innerHTML = currentUser.subjects.map(s => `<option>${s.trim()}</option>`).join('');
    document.getElementById('tClass').innerHTML = currentUser.classes.map(c => `<option>${c.trim()}</option>`).join('');

    // Listen for Learners
    rdb.ref('learners/' + currentUser.name).on('value', (snap) => {
      const dir = document.getElementById('learnerDir');
      dir.innerHTML = '';
      snap.forEach((child) => {
        const l = child.val();
        dir.innerHTML += `<div class="learner-row">
          <span>${l.name}</span>
          <button class="btn-delete" onclick="removeLearner('${child.key}')">×</button>
        </div>`;
      });
    });

    // Listen for Tasks
    rdb.ref('tasks').on('value', (snap) => {
      const feed = document.getElementById('taskFeed');
      feed.innerHTML = '';
      snap.forEach((child) => {
        const t = child.val();
        feed.innerHTML += `<div class="card"><h4>${t.title}</h4><p>${t.desc}</p></div>`;
      });
    });
  }

  function addLearner() {
    const name = document.getElementById('lName').value;
    const email = document.getElementById('lEmail').value;
    rdb.ref('learners/' + currentUser.name).push({ name, email });
  }

  function removeLearner(key) {
    rdb.ref('learners/' + currentUser.name + '/' + key).remove();
  }

  function addTask() {
    rdb.ref('tasks').push({
      title: document.getElementById('tTitle').value,
      desc: document.getElementById('tDesc').value,
      teacher: currentUser.name
    });
  }
</script>
</body>
</html>
