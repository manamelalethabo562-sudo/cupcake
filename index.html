<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <title>All"Apps | Discover</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; }
        .glass { background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); }
        .app-card:active { transform: scale(0.96); }
    </style>
</head>
<body class="bg-[#F2F2F7] text-gray-900 pb-24 md:pb-0">
    <aside class="hidden md:flex flex-col w-72 fixed h-full bg-white border-r p-8 z-50">
        <h1 class="text-3xl font-black text-blue-600 tracking-tighter mb-10">All"Apps</h1>
        <nav class="space-y-1 flex-1">
            <a href="#" class="flex items-center space-x-4 bg-blue-50 text-blue-600 px-4 py-3 rounded-2xl font-bold">
                <i class="fa-solid fa-house text-lg"></i> <span>Discover</span>
            </a>
            <a href="#" class="flex items-center space-x-4 text-gray-400 hover:bg-gray-50 px-4 py-3 rounded-2xl transition group">
                <i class="fa-solid fa-gamepad text-lg group-hover:text-blue-500"></i> <span>Games</span>
            </a>
            <a href="#" class="flex items-center space-x-4 text-gray-400 hover:bg-gray-50 px-4 py-3 rounded-2xl transition group">
                <i class="fa-solid fa-layer-group text-lg group-hover:text-blue-500"></i> <span>Apps</span>
            </a>
            <a href="#" class="flex items-center space-x-4 text-gray-400 hover:bg-gray-50 px-4 py-3 rounded-2xl transition group">
                <i class="fa-solid fa-rocket text-lg group-hover:text-blue-500"></i> <span>Arcade</span>
            </a>
        </nav>
        <div class="mt-auto flex items-center space-x-3 p-4 bg-gray-50 rounded-2xl cursor-pointer">
            <div class="w-10 h-10 bg-gradient-to-tr from-blue-500 to-indigo-600 rounded-full flex items-center justify-center text-white font-bold">JS</div>
            <div>
                <p class="text-sm font-bold">John Smith</p>
                <p class="text-[10px] text-gray-400">Pro Account</p>
            </div>
        </div>
    </aside>
    <main class="md:ml-72 min-h-screen">
       
        <header class="p-6 md:p-10 flex justify-between items-end sticky top-0 z-40 md:static glass md:bg-transparent md:backdrop-blur-none">
            <div>
                <p class="text-[11px] font-extrabold text-gray-400 uppercase tracking-[0.2em]">Tuesday, Jan 27</p>
                <h1 class="text-4xl font-black tracking-tight">Today</h1>
            </div>
            <div class="hidden md:block w-80">
                <div class="relative">
                    <i class="fa-solid fa-magnifying-glass absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
                    <input type="text" placeholder="Search apps..." class="w-full pl-11 pr-4 py-3 bg-white border border-gray-200 rounded-2xl focus:outline-none focus:ring-4 focus:ring-blue-100 transition shadow-sm">
                </div>
            </div>
            <div class="md:hidden w-10 h-10 bg-gray-200 rounded-full overflow-hidden">
                <img src="https://ui-avatars.com/api/?name=John+Smith&background=0D8ABC&color=fff" alt="Profile">
            </div>
        </header>
        <section class="px-6 md:px-10 pb-12 max-w-7xl">
            <div class="relative w-full h-[500px] rounded-[2.5rem] overflow-hidden shadow-2xl mb-12 group cursor-pointer">
                <img src="https://images.unsplash.com/photo-1550745165-9bc0b252726f?auto=format&fit=crop&q=80&w=1200" class="absolute inset-0 w-full h-full object-cover transition duration-1000 group-hover:scale-105" alt="Feature">
                <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-black/20 to-transparent"></div>
                <div class="absolute bottom-10 left-10 right-10 text-white">
                    <p class="text-xs font-bold uppercase opacity-70 tracking-widest mb-2">Editor's Choice</p>
                    <h2 class="text-5xl font-black mb-4 leading-none">Retro Vibes:<br>Ultimate Synth</h2>
                    <p class="text-lg text-gray-300 max-w-md mb-6 hidden md:block">Step into the 80s with the most advanced synthesizer app ever built for mobile.</p>
                    <button class="bg-blue-600 text-white px-8 py-3 rounded-full font-bold text-sm hover:scale-105 transition active:scale-95 shadow-lg shadow-blue-500/50">Get Now</button>
                </div>
            </div>
            <div class="flex justify-between items-end mb-8">
                <div>
                    <h2 class="text-3xl font-black">Must-Have Apps</h2>
                    <p class="text-gray-500 font-medium">Updated just now</p>
                </div>
                <a href="#" class="text-blue-600 font-bold hover:underline">See All</a>
            </div>
            <div id="app-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Apps will be rendered here dynamically -->
            </div>
        </section>
    </main>
    <nav class="md:hidden fixed bottom-6 left-6 right-6 h-16 glass border border-white/20 shadow-2xl rounded-3xl flex justify-around items-center text-gray-400 z-50">
        <a href="#" class="flex flex-col items-center text-blue-600">
            <i class="fa-solid fa-house text-xl"></i>
            <span class="text-[9px] font-bold mt-1">Today</span>
        </a>
        <a href="#" class="flex flex-col items-center">
            <i class="fa-solid fa-gamepad text-xl"></i>
            <span class="text-[9px] font-bold mt-1">Games</span>
        </a>
        <a href="#" class="flex flex-col items-center">
            <i class="fa-solid fa-layer-group text-xl"></i>
            <span class="text-[9px] font-bold mt-1">Apps</span>
        </a>
        <a href="#" class="flex flex-col items-center">
            <i class="fa-solid fa-magnifying-glass text-xl"></i>
            <span class="text-[9px] font-bold mt-1">Search</span>
        </a>
    </nav>

    <!-- Floating Action Button for Upload -->
    <div class="fixed bottom-24 right-6 md:bottom-10 md:right-10 z-50">
        <button id="uploadBtn" class="w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center text-white shadow-2xl hover:bg-blue-700 transition transform hover:scale-110 active:scale-95">
            <i class="fa-solid fa-cloud-arrow-up text-3xl"></i>
        </button>
    </div>

    <!-- Upload Modal -->
    <div id="uploadModal" class="hidden fixed inset-0 bg-black/60 flex items-center justify-center z-50">
        <div class="bg-white rounded-3xl p-8 max-w-lg w-full mx-4 shadow-2xl">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl md:text-3xl font-black text-gray-900">Upload Your App</h2>
                <button id="closeModalBtn" class="text-gray-500 hover:text-gray-900 text-2xl">&times;</button>
            </div>
            <form id="uploadForm" class="space-y-5">
                <div>
                    <label for="appName" class="block text-sm font-bold text-gray-700 mb-2">App Name *</label>
                    <input type="text" id="appName" required placeholder="e.g. My Cool App" class="w-full p-4 border border-gray-300 rounded-2xl focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label for="appCategory" class="block text-sm font-bold text-gray-700 mb-2">Category *</label>
                    <input type="text" id="appCategory" required placeholder="e.g. Productivity, Graphics & Design" class="w-full p-4 border border-gray-300 rounded-2xl focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label for="appPrice" class="block text-sm font-bold text-gray-700 mb-2">Price *</label>
                    <input type="text" id="appPrice" required placeholder="e.g. Free or $4.99" class="w-full p-4 border border-gray-300 rounded-2xl focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label for="appRating" class="block text-sm font-bold text-gray-700 mb-2">Rating (optional)</label>
                    <input type="text" id="appRating" placeholder="e.g. 4.8" class="w-full p-4 border border-gray-300 rounded-2xl focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label for="appIcon" class="block text-sm font-bold text-gray-700 mb-2">App Icon (optional - PNG/JPG recommended)</label>
                    <input type="file" id="appIcon" accept="image/*" class="w-full p-3 border border-gray-300 rounded-2xl bg-gray-50">
                </div>
                <div class="flex justify-end space-x-4 pt-4">
                    <button type="button" id="cancelBtn" class="px-8 py-4 bg-gray-200 text-gray-800 font-bold rounded-full hover:bg-gray-300 transition">Cancel</button>
                    <button type="submit" class="px-8 py-4 bg-blue-600 text-white font-bold rounded-full hover:bg-blue-700 transition">Upload App</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Firebase SDK + App Logic -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js';
        import { getDatabase, ref, onValue, push } from 'https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js';
        import { getStorage, ref as storageRef, uploadBytes, getDownloadURL } from 'https://www.gstatic.com/firebasejs/12.8.0/firebase-storage.js';

        // Your Firebase config
        const firebaseConfig = {
          apiKey: "AIzaSyCLqZqiW91FlivfkL3ZGtWUh7x2XpX4HPo",
          authDomain: "all-apps-36756.firebaseapp.com",
          databaseURL: "https://all-apps-36756-default-rtdb.firebaseio.com",
          projectId: "all-apps-36756",
          storageBucket: "all-apps-36756.firebasestorage.app",
          messagingSenderId: "1088890111578",
          appId: "1:1088890111578:web:9cb544e599626b61a63a63",
          measurementId: "G-5Z763J47HR"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const storage = getStorage(app);

        console.log("Firebase initialized successfully!");

        // MOCK DATA (fallback if no apps in database)
        const mockApps = [
            { name: "ProCreate Pocket", category: "Graphics & Design", rating: "4.9", price: "Free" },
            { name: "Sky Guide", category: "Education", rating: "4.8", price: "Free" },
            { name: "LumaFusion", category: "Video Editing", rating: "4.7", price: "Get" },
            { name: "Streaks", category: "Health & Fitness", rating: "4.9", price: "Free" },
            { name: "Overcast", category: "Entertainment", rating: "4.8", price: "Free" },
            { name: "Bear Notes", category: "Productivity", rating: "4.6", price: "Get" }
        ];

        const grid = document.getElementById('app-grid');

        function renderApps(appsList) {
            grid.innerHTML = '';
            appsList.forEach(app => {
                const iconUrl = app.iconUrl || `https://ui-avatars.com/api/?name=${encodeURIComponent(app.name)}&background=0D8ABC&color=fff&size=128&bold=true`;
                const card = `
                    <div class="app-card flex items-center space-x-4 bg-white p-5 rounded-[2rem] shadow-sm hover:shadow-xl transition duration-300 cursor-pointer group border border-transparent hover:border-blue-100">
                        <div class="w-20 h-20 rounded-[1.5rem] overflow-hidden shrink-0 group-hover:rotate-3 transition-transform duration-300">
                            <img src="${iconUrl}" alt="${app.name}" class="w-full h-full object-cover">
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3 class="font-extrabold text-gray-900 truncate text-lg tracking-tight leading-tight">${app.name}</h3>
                            <p class="text-xs font-bold text-gray-400 uppercase tracking-wide mb-2">${app.category}</p>
                            <div class="flex items-center justify-between">
                                <button class="bg-[#F0F0F7] text-blue-600 px-6 py-1.5 rounded-full text-xs font-black uppercase tracking-widest hover:bg-blue-600 hover:text-white transition">
                                    ${app.price}
                                </button>
                                <div class="flex items-center space-x-1">
                                    <span class="text-xs font-bold text-gray-800">${app.rating || 'N/A'}</span>
                                    <i class="fa-solid fa-star text-[10px] text-yellow-400"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                grid.innerHTML += card;
            });
        }

        // Listen for real-time updates from Firebase Realtime Database
        const appsRef = ref(db, 'apps');
        onValue(appsRef, (snapshot) => {
            const data = snapshot.val();
            if (data && Object.keys(data).length > 0) {
                const fetchedApps = Object.values(data);
                renderApps(fetchedApps);
            } else {
                // Fallback to mock data if database is empty
                renderApps(mockApps);
            }
        });

        // Upload Modal Controls
        const uploadBtn = document.getElementById('uploadBtn');
        const modal = document.getElementById('uploadModal');
        const cancelBtn = document.getElementById('cancelBtn');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const uploadForm = document.getElementById('uploadForm');

        const openModal = () => modal.classList.remove('hidden');
        const closeModal = () => {
            modal.classList.add('hidden');
            uploadForm.reset();
        };

        uploadBtn.addEventListener('click', openModal);
        cancelBtn.addEventListener('click', closeModal);
        closeModalBtn.addEventListener('click', closeModal);

        // Close modal when clicking outside
        modal.addEventListener('click', (e) => {
            if (e.target === modal) closeModal();
        });

        // Handle form submission
        uploadForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            const name = document.getElementById('appName').value.trim();
            const category = document.getElementById('appCategory').value.trim();
            const price = document.getElementById('appPrice').value.trim();
            const rating = document.getElementById('appRating').value.trim();
            const file = document.getElementById('appIcon').files[0];

            if (!name || !category || !price) {
                alert('Please fill in all required fields (App Name, Category, Price).');
                return;
            }

            let iconUrl = `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=0D8ABC&color=fff&size=128&bold=true`;

            if (file) {
                try {
                    const storagePathRef = storageRef(storage, `app-icons/${Date.now()}_${file.name}`);
                    await uploadBytes(storagePathRef, file);
                    iconUrl = await getDownloadURL(storagePathRef);
                } catch (err) {
                    console.error('Storage upload error:', err);
                    alert('Failed to upload icon. Using default avatar instead.');
                }
            }

            const newApp = {
                name,
                category,
                price,
                rating: rating || 'N/A',
                iconUrl,
                uploadedAt: new Date().toISOString()
            };

            try {
                await push(ref(db, 'apps'), newApp);
                alert('App uploaded successfully!');
                closeModal();
            } catch (error) {
                console.error('Database push error:', error);
                alert('Failed to upload app. Check console for details.');
            }
        });
    </script>
</body>
</html>
