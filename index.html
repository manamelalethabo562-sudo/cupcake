<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Lumina â€¢ Teacher Portal</title>
  <style>
    :root {
      --bg: #0f0f17;
      --surface: #1a1a2e;
      --text: #e2e8f0;
      --text-muted: #94a3b8;
      --primary: #6366f1;
      --primary-hover: #4f46e5;
      --accent: #a78bfa;
      --border: #334155;
      --success: #10b981;
      --danger: #ef4444;
      --chat-bg: #0f172a;
      --chat-self: #4338ca;
      --chat-other: #334155;
    }

    [data-theme="light"] {
      --bg: #f8fafc;
      --surface: #ffffff;
      --text: #1e293b;
      --text-muted: #64748b;
      --border: #e2e8f0;
      --chat-bg: #f1f5f9;
      --chat-self: #6366f1;
      --chat-other: #e2e8f0;
    }

    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: system-ui, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      line-height: 1.5;
    }
    .container { max-width:1280px; margin:0 auto; padding:1.5rem; }
    header { border-bottom:1px solid var(--border); padding:1rem 0; margin-bottom:2rem; }
    .flex { display:flex; gap:1rem; align-items:center; flex-wrap:wrap; }
    .flex-between { justify-content:space-between; }
    h1 { font-size:1.8rem; font-weight:700; }
    h2,h3 { margin-bottom:0.8rem; }
    button {
      background:var(--primary); color:white; border:none;
      padding:0.65rem 1.25rem; border-radius:0.5rem;
      font-weight:600; cursor:pointer; transition:all 0.2s;
    }
    button:hover { background:var(--primary-hover); }
    button.outline { background:transparent; border:1px solid var(--border); color:var(--text); }
    button.outline:hover { background:rgba(255,255,255,0.08); }
    input, textarea, select {
      background:var(--surface); border:1px solid var(--border); color:var(--text);
      padding:0.65rem 1rem; border-radius:0.5rem; width:100%;
    }
    input:focus, textarea:focus { outline:none; border-color:var(--primary); box-shadow:0 0 0 3px rgba(99,102,241,0.2); }
    .card { background:var(--surface); border:1px solid var(--border); border-radius:0.75rem; padding:1.5rem; margin-bottom:1.5rem; }
    .grid-2 { display:grid; grid-template-columns:repeat(auto-fit, minmax(320px, 1fr)); gap:1.5rem; }
    .hidden { display:none !important; }

    /* Chat styles */
    #chatView {
      background: var(--chat-bg);
      border-radius: 0.75rem;
      overflow: hidden;
      height: 70vh;
      display: flex;
      flex-direction: column;
    }
    #chatHeader {
      padding: 1rem 1.5rem;
      background: rgba(0,0,0,0.2);
      border-bottom: 1px solid var(--border);
    }
    #messagesContainer {
      flex: 1;
      padding: 1.5rem;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    .message {
      max-width: 75%;
      padding: 0.9rem 1.3rem;
      border-radius: 1.1rem;
      position: relative;
    }
    .message-self {
      align-self: flex-end;
      background: var(--chat-self);
      color: white;
      border-bottom-right-radius: 0.4rem;
    }
    .message-other {
      align-self: flex-start;
      background: var(--chat-other);
      border-bottom-left-radius: 0.4rem;
    }
    .message-sender {
      font-size: 0.85rem;
      opacity: 0.8;
      margin-bottom: 0.3rem;
    }
    .message-time {
      font-size: 0.7rem;
      opacity: 0.6;
      margin-top: 0.4rem;
      text-align: right;
    }
    #chatInputArea {
      padding: 1rem 1.5rem;
      border-top: 1px solid var(--border);
      background: var(--surface);
      display: flex;
      gap: 0.8rem;
    }
    #chatInputArea input {
      flex: 1;
    }
    .theme-toggle { background:none; border:none; font-size:1.3rem; cursor:pointer; }

    .submission-item { border:1px solid var(--border); border-radius:0.5rem; padding:1rem; margin:1rem 0; }
  </style>
</head>
<body>

  <!-- Login -->
  <div id="loginScreen" class="container" style="max-width:420px; margin:10vh auto; text-align:center;">
    <h1>Lumina Teacher</h1>
    <p style="margin:1rem 0 2rem; color:var(--text-muted);">Classes, tasks, submissions & class chat</p>
    <div class="card">
      <form id="loginForm">
        <input type="email" id="email" placeholder="teacher@example.com" required style="margin-bottom:1rem;"/>
        <input type="password" id="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required style="margin-bottom:1.5rem;"/>
        <button type="submit" style="width:100%;">Sign In</button>
      </form>
    </div>
  </div>

  <!-- Dashboard -->
  <div id="dashboard" class="hidden">
    <header class="container flex flex-between">
      <div class="flex">
        <h1>Lumina</h1>
        <span style="margin-left:1.5rem; color:var(--text-muted);">Teacher Portal</span>
      </div>
      <div class="flex">
        <button class="theme-toggle" onclick="toggleTheme()" title="Toggle theme">ğŸŒ™</button>
        <button onclick="logout()">Sign Out</button>
      </div>
    </header>

    <div class="container">
      <h2>Welcome, <span id="teacherName">Teacher</span></h2>

      <!-- MAIN VIEWS -->
      <div id="classListView">
        <div class="flex flex-between" style="margin:1.5rem 0 1rem;">
          <h3>Your Classes</h3>
          <button onclick="showModal('createClassModal')">+ New Class</button>
        </div>
        <div class="grid-2" id="classesList"></div>
      </div>

      <div id="taskListView" class="hidden">
        <div class="flex flex-between" style="margin-bottom:1.5rem;">
          <h3 id="currentClassTitle">Tasks</h3>
          <div class="flex">
            <button onclick="showChatForClass()">Chat</button>
            <button onclick="showClassList()">â† Classes</button>
          </div>
        </div>
        <div id="tasksContainer" class="grid-2"></div>
        <button onclick="showModal('createTaskModal')" style="margin-top:1.5rem;">+ Assign Task</button>
      </div>

      <div id="submissionView" class="hidden">
        <div class="flex flex-between" style="margin-bottom:1.5rem;">
          <h3 id="submissionTaskTitle">Submissions</h3>
          <button onclick="showTaskList(currentClassId)">â† Tasks</button>
        </div>
        <div id="submissionsContainer"></div>
      </div>

      <!-- CHAT VIEW -->
      <div id="chatView" class="hidden">
        <div id="chatHeader" class="flex flex-between">
          <h3 id="chatClassName">Class Chat</h3>
          <button onclick="closeChat()">â† Back</button>
        </div>
        <div id="messagesContainer"></div>
        <div id="chatInputArea">
          <input type="text" id="chatMessageInput" placeholder="Type your message to the class..."/>
          <button onclick="sendChatMessage()">Send</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modals (Class + Task) â€“ same as previous versions -->
  <div id="createClassModal" class="hidden" style="position:fixed;inset:0;background:rgba(0,0,0,0.7);display:flex;align-items:center;justify-content:center;z-index:1000;">
    <div class="card" style="width:90%;max-width:480px;">
      <h2>Create Class</h2>
      <form id="createClassForm" style="margin-top:1.5rem;">
        <div style="margin-bottom:1.25rem;">
          <label>Class Name</label>
          <input type="text" id="className" required placeholder="Grade 10 Mathematics"/>
        </div>
        <div style="margin-bottom:1.5rem;">
          <label>Subject (optional)</label>
          <input type="text" id="classSubject" placeholder="Mathematics"/>
        </div>
        <div class="flex" style="justify-content:flex-end;gap:1rem;">
          <button type="button" class="outline" onclick="closeModal('createClassModal')">Cancel</button>
          <button type="submit">Create</button>
        </div>
      </form>
    </div>
  </div>

  <div id="createTaskModal" class="hidden" style="position:fixed;inset:0;background:rgba(0,0,0,0.7);display:flex;align-items:center;justify-content:center;z-index:1000;">
    <div class="card" style="width:90%;max-width:560px;">
      <h2>Assign Task</h2>
      <form id="createTaskForm" style="margin-top:1.5rem;">
        <div style="margin-bottom:1.25rem;">
          <label>Class</label>
          <select id="taskClassId" required></select>
        </div>
        <div style="margin-bottom:1.25rem;">
          <label>Title</label>
          <input type="text" id="taskTitle" required placeholder="Chapter 5 Questions"/>
        </div>
        <div style="margin-bottom:1.25rem;">
          <label>Instructions</label>
          <textarea id="taskDesc" rows="4" placeholder="Complete questions 1â€“10. Show all working..."></textarea>
        </div>
        <div style="margin-bottom:1.5rem;">
          <label>Due Date (optional)</label>
          <input type="date" id="taskDueDate"/>
        </div>
        <div class="flex" style="justify-content:flex-end;gap:1rem;">
          <button type="button" class="outline" onclick="closeModal('createTaskModal')">Cancel</button>
          <button type="submit">Assign</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Data
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    let currentUser = null;
    let classes = [];
    let tasks = [];
    let submissions = [];
    let chatMessages = {}; // { classId: [ {sender, text, timestamp, isTeacher} ] }

    let currentClassId = null;
    let currentTaskId = null;

    const views = {
      classList: document.getElementById("classListView"),
      taskList: document.getElementById("taskListView"),
      submission: document.getElementById("submissionView"),
      chat: document.getElementById("chatView")
    };

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Login
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    document.getElementById("loginForm").addEventListener("submit", e => {
      e.preventDefault();
      const email = document.getElementById("email").value.trim();
      if (email) {
        currentUser = { name: email.split("@")[0] || "Teacher" };
        document.getElementById("teacherName").textContent = currentUser.name;
        document.getElementById("loginScreen").classList.add("hidden");
        document.getElementById("dashboard").classList.remove("hidden");
        renderClasses();
      }
    });

    function logout() {
      currentUser = null;
      document.getElementById("dashboard").classList.add("hidden");
      document.getElementById("loginScreen").classList.remove("hidden");
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Navigation
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function showClassList() {
      currentClassId = null;
      Object.values(views).forEach(v => v.classList.add("hidden"));
      views.classList.classList.remove("hidden");
      renderClasses();
    }

    function showTaskList(classId) {
      currentClassId = classId;
      const cls = classes.find(c => c.id === classId);
      document.getElementById("currentClassTitle").textContent = `Tasks â€¢ ${cls?.name || ''}`;
      Object.values(views).forEach(v => v.classList.add("hidden"));
      views.taskList.classList.remove("hidden");
      renderTasksForCurrentClass();
    }

    function showSubmissions(taskId) {
      currentTaskId = taskId;
      const task = tasks.find(t => t.id === taskId);
      document.getElementById("submissionTaskTitle").textContent = `Submissions â€¢ ${task?.title || ''}`;
      Object.values(views).forEach(v => v.classList.add("hidden"));
      views.submission.classList.remove("hidden");
      renderSubmissionsForTask();
    }

    function showChatForClass(classId = currentClassId) {
      currentClassId = classId;
      const cls = classes.find(c => c.id === classId);
      document.getElementById("chatClassName").textContent = `Chat â€¢ ${cls?.name || 'Class'}`;
      Object.values(views).forEach(v => v.classList.add("hidden"));
      views.chat.classList.remove("hidden");
      renderChatMessages();
      scrollChatToBottom();
    }

    function closeChat() {
      views.chat.classList.add("hidden");
      showTaskList(currentClassId); // or showClassList() if preferred
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Render
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function renderClasses() {
      const container = document.getElementById("classesList");
      container.innerHTML = classes.length === 0
        ? `<p style="grid-column:1/-1;text-align:center;color:var(--text-muted);">No classes yet</p>`
        : "";

      classes.forEach(cls => {
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <h3>${cls.name}</h3>
          <p style="color:var(--text-muted);">${cls.subject || 'â€”'} â€¢ ${cls.studentCount || 0} learners</p>
          <div style="margin-top:1.25rem;" class="flex" class="flex-wrap">
            <button onclick="showTaskList('${cls.id}')">Tasks</button>
            <button onclick="showChatForClass('${cls.id}')">Chat</button>
          </div>
        `;
        container.appendChild(card);
      });
    }

    function renderTasksForCurrentClass() {
      const container = document.getElementById("tasksContainer");
      container.innerHTML = "";
      const classTasks = tasks.filter(t => t.classId === currentClassId);
      if (classTasks.length === 0) {
        container.innerHTML = `<p style="grid-column:1/-1;text-align:center;color:var(--text-muted);">No tasks yet</p>`;
        return;
      }
      classTasks.forEach(task => {
        const subs = submissions.filter(s => s.taskId === task.id).length;
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <h3>${task.title}</h3>
          <p style="color:var(--text-muted);margin:0.4rem 0;">${task.description?.substring(0,70) || ''}${task.description?.length > 70 ? '...' : ''}</p>
          <p style="color:var(--text-muted);font-size:0.95rem;">
            Due: ${task.dueDate || 'â€”'} â€¢ ${subs} submission${subs !== 1 ? 's' : ''}
          </p>
          <button style="margin-top:1rem;" onclick="showSubmissions('${task.id}')">View Submissions</button>
        `;
        container.appendChild(card);
      });
    }

    function renderSubmissionsForTask() {
      const container = document.getElementById("submissionsContainer");
      container.innerHTML = "";
      const taskSubs = submissions.filter(s => s.taskId === currentTaskId);
      if (taskSubs.length === 0) {
        container.innerHTML = `<p style="text-align:center;color:var(--text-muted);">No submissions yet.</p>`;
        return;
      }
      taskSubs.forEach(sub => {
        const div = document.createElement("div");
        div.className = "submission-item";
        div.innerHTML = `
          <div class="flex flex-between" style="margin-bottom:0.6rem;font-weight:600;">
            <span>${sub.studentName}</span>
            <span style="font-size:0.9rem;opacity:0.8;">${sub.submittedAt}</span>
          </div>
          <p style="white-space:pre-wrap;margin-bottom:1rem;">${sub.content || "(empty)"}</p>
          <div>
            <strong>Grade:</strong> ${sub.grade ?? "â€”"}<br>
            <strong>Feedback:</strong> <span style="white-space:pre-wrap;">${sub.teacherFeedback || "(none yet)"}</span>
          </div>
          <form data-sub-id="${sub.id}" style="margin-top:1.25rem;">
            <div style="margin:0.8rem 0;">
              <label>Grade (0â€“100)</label>
              <input type="number" min="0" max="100" value="${sub.grade||''}"/>
            </div>
            <div style="margin-bottom:0.8rem;">
              <label>Feedback</label>
              <textarea rows="3">${sub.teacherFeedback||''}</textarea>
            </div>
            <button type="submit">Save</button>
          </form>
        `;
        container.appendChild(div);

        div.querySelector("form").addEventListener("submit", e => {
          e.preventDefault();
          const [gradeInput, feedbackTa] = e.target.querySelectorAll("input, textarea");
          sub.grade = parseInt(gradeInput.value) || null;
          sub.teacherFeedback = feedbackTa.value.trim();
          alert(`Updated for ${sub.studentName}`);
          renderSubmissionsForTask();
        });
      });
    }

    function renderChatMessages() {
      const container = document.getElementById("messagesContainer");
      container.innerHTML = "";
      const msgs = chatMessages[currentClassId] || [];
      msgs.forEach(m => {
        const div = document.createElement("div");
        div.className = `message ${m.isTeacher ? 'message-self' : 'message-other'}`;
        div.innerHTML = `
          <div class="message-sender">${m.sender}</div>
          <div>${m.text}</div>
          <div class="message-time">${m.timestamp}</div>
        `;
        container.appendChild(div);
      });
      scrollChatToBottom();
    }

    function scrollChatToBottom() {
      const container = document.getElementById("messagesContainer");
      container.scrollTop = container.scrollHeight;
    }

    function sendChatMessage() {
      const input = document.getElementById("chatMessageInput");
      const text = input.value.trim();
      if (!text || !currentClassId) return;

      if (!chatMessages[currentClassId]) chatMessages[currentClassId] = [];

      chatMessages[currentClassId].push({
        sender: currentUser.name + " (Teacher)",
        text,
        timestamp: new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}),
        isTeacher: true
      });

      input.value = "";
      renderChatMessages();
    }

    // Fake learner messages (demo)
    setInterval(() => {
      if (currentClassId && views.chat.classList.contains("hidden") === false && Math.random() < 0.15) {
        const fakeNames = ["Thabo", "Lerato", "Amahle", "Sipho", "Nia"];
        const name = fakeNames[Math.floor(Math.random() * fakeNames.length)];
        if (!chatMessages[currentClassId]) chatMessages[currentClassId] = [];
        chatMessages[currentClassId].push({
          sender: name,
          text: ["Sir, question 3 please?", "Understood, thank you!", "When is the next test?", "I submitted already"][Math.floor(Math.random()*4)],
          timestamp: new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}),
          isTeacher: false
        });
        renderChatMessages();
      }
    }, 12000);

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Forms
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    document.getElementById("createClassForm").addEventListener("submit", e => {
      e.preventDefault();
      const name = document.getElementById("className").value.trim();
      if (!name) return;
      const cls = {
        id: "cls_" + Date.now(),
        name,
        subject: document.getElementById("classSubject").value.trim() || "General",
        studentCount: 0
      };
      classes.push(cls);
      renderClasses();
      updateTaskClassOptions();
      closeModal("createClassModal");
    });

    document.getElementById("createTaskForm").addEventListener("submit", e => {
      e.preventDefault();
      const classId = document.getElementById("taskClassId").value;
      const title = document.getElementById("taskTitle").value.trim();
      if (!classId || !title) return;
      const task = {
        id: "tsk_" + Date.now(),
        classId,
        title,
        description: document.getElementById("taskDesc").value.trim(),
        dueDate: document.getElementById("taskDueDate").value || null
      };
      tasks.push(task);

      // Demo submissions
      ["Thabo", "Lerato", "Amahle"].forEach((n,i) => {
        submissions.push({
          id: "sub_" + Date.now() + i,
          taskId: task.id,
          studentName: n,
          content: `My answer for ${title}...`,
          submittedAt: new Date().toLocaleDateString(),
          grade: null,
          teacherFeedback: ""
        });
      });

      closeModal("createTaskModal");
      showTaskList(classId);
    });

    function updateTaskClassOptions() {
      const sel = document.getElementById("taskClassId");
      sel.innerHTML = '<option value="">Select class...</option>';
      classes.forEach(c => {
        const opt = document.createElement("option");
        opt.value = c.id;
        opt.textContent = c.name;
        sel.appendChild(opt);
      });
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Helpers
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function showModal(id) { document.getElementById(id).classList.remove("hidden"); }
    function closeModal(id) { document.getElementById(id).classList.add("hidden"); }

    function toggleTheme() {
      document.documentElement.setAttribute("data-theme",
        document.documentElement.getAttribute("data-theme") === "dark" ? "light" : "dark");
    }

    document.documentElement.setAttribute("data-theme", "dark");
  </script>
</body>
</html>
